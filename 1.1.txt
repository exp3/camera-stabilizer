#include <Servo.h>

void input();
void output();
void DebugLog();

//宣言
Servo myServo; // create a servo object
 
int const potPin = A0; // analog pin used to connect the potentiometer
int input_x, input_y, input_z; //インプットの値
int input_Calibrationed_x, input_Calibrationed_y, input_Calibrationed_z;//キャリブレーション用
int count;//デバッグのタイミングカウント用
int output_x, output_y, output_z;//アウトプット用
float outputf_x;//アウトプットのfloat型用

//初期化の関数
void setup() {
    myServo.attach(2);  //サーボモータをポート２にアタッチ //attach servo motor
    Serial.begin(9600); // 9600bpsでシリアルポートを開く

    //インプット変数初期化
    input_x = 0;
    input_y = 0;
    input_z = 0;

    //駆動開始宣言
    
    Serial.print("start");
    Serial.println();

    //動作確認駆動
    delay(1000);
    myServo.write(150); //output to servo motor
    delay(2000);
    myServo.write(30);
    delay(2000);
    myServo.write(90);
    delay(2000);

    //キャリブレーション用の値測定（初期値）
    input_Calibrationed_x = analogRead(pin);
    input_Calibrationed_y = analogRead(1);
    input_Calibrationed_z = analogRead(2);

    count = 0;
}
 
void loop() {

    //入力
    input();

    //補正
    correct();
    
    //出力
    output();

    //シリアル通信での値の表示を1秒毎に行う
    if(count == 20){
        DebugLog(x, y, z);
        count = 0;
    }

    delay(50);
    count++;
}

void input(){
    input_x = analogRead(0);
    input_y = analogRead(1);    
    input_z = analogRead(2);
}

void correct(){
    outputf_x = 100 + (input_Calibrationed_x + 200 - input_x) * 0.45;    //0.45 = 90° ÷ 200

    output_x = outputf_x;
}

void output(){
    myServo.write(output_x);
}

void DebugLog(void){
    Serial.print("x = ");
    Serial.print(input_x);
    Serial.println(); //改行
    Serial.print("y = ");
    Serial.print(input_y);
    Serial.println();
    Serial.print("z = ");
    Serial.print(input_z);
    Serial.println();
    Serial.println();
}

